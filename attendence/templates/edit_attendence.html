{% extends 'base.html'%}
{% load static %}
{% block content %}

<form method="get">
  <div class="row">
      <div class="col-md-6">
          <label class="form-label">Choose Date</label>
          
          
          <input type="date" class="form-control" name="date" id="date" value="{{selected_date}}">
      </div>
      <div class="col-12 text-center">
          <button type="submit" class="btn btn-primary">VIEW</button>
        </div>
      
  </div>
</form>

<div class="row mt-5">
<table class="table " id="attendence" class="attendence">
  <thead>
    <tr>
      <th scope="col">Student Name</th>
      <th scope="col"></th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
   {%for student in attendences%}
    <tr>
      <td id="name">{{student.student.user.first_name}}</td>
      <td>
        {%if student.is_present is True%}
            <input type="checkbox" class="styled-checkbox" name="check" id="check" checked >
        {%else%} 
          <input type="checkbox" class="styled-checkbox" name="check" id="check" value="checked" >
        {%endif%}
      </td>
    </tr>
{%endfor%}
  </tbody>
</table>
</div>
<div class="row">
  <button class=" my_button btn btn-primary"  onclick="greet()">EDIT</button>
</div>

<script>

  function greet() {
    var selected_date= document.querySelector('input').value;
    console.log(selected_date)
    var myTab = document.getElementById('attendence')
    var rowLength = myTab.rows.length;
    list=[]
    
    for (i = 1; i < rowLength; i++){

      //gets cells of current row  
       var oCells = myTab.rows.item(i).cells;

        //gets amount of cells of current row
       var cellLength = oCells.length;

       
       var cellVal1 = oCells.item(0).innerHTML
       var cellVal2 = oCells.item(1).childNodes[1].checked
       
       console.log(cellVal1)
       console.log(cellVal2) 

       const obj={name:cellVal1,is_present:cellVal2}
       //const myJSON = JSON.stringify(obj);
       list.push(obj)

       
    } 
    console.log(list) 
    const newJSON={'attendences':JSON.stringify(list),'csrfmiddlewaretoken':'{{csrf_token}}','selected_date':selected_date}
    
    console.log(newJSON)
    
    
    $.ajax({
        type: 'POST',
        url: '/class/{{class_id}}/semester/{{semester_id}}/subject/{{subject_id}}/edit-attendence',
        data:newJSON,
        datatype: 'json',
        
        success: function (data) {
          
            window.location.replace('/class/{{class_id}}/semester/{{semester_id}}/subject/{{subject_id}}/view-attendence?date={{selected_date}}')
        
        }
        
        });
  }


</script> 








{%endblock%}
{%block script%}
<script>
  $(function () {
    $("#attendence").dataTable();
  })
</script>
{%endblock%}